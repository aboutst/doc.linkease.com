### 跨大版本升级说明
* 这是 24.10，从 22.03 升级的话，升级前做好备份。如果要备份所有插件和配置文件，可以参考这个[视频](https://www.bilibili.com/video/BV1eFJVzbEjU/?t=181)，这个备份可能要花几分钟时间。如果只需要备份配置文件，可以使用系统原生的备份功能，例如 ```http://istoreos.lan/cgi-bin/luci/admin/system/flash``` 。

* 升级前，最好先执行下修复系统组件：从iStore安装“系统便利工具”，打开，选择“修复系统软件”，执行。

* 防火墙切换到 nftables，有些插件可能不兼容，或者需要手动选择防火墙类型。
如果状态-防火墙页面显示“系统上存在旧版 iptables 规则。 不鼓励混合使用 iptables 和 nftables 规则，这可能会导致流量过滤不完整。”，如果有基于防火墙的透明代理/去广告/网络管控插件，更新到最新版本，选择防火墙类型 nftables。其他统计类插件（例如“实时流量”插件）一般可以忽略此提醒。目前“简单网络管控”插件不兼容，等未来更新。

* socat端口转发已经不再是必须的，现在的防火墙已经支持ipv4和ipv6之间互相转发，socat插件完全失去了原来的独特优势。

（此说明可能会持续一段时间，如果已经升级 24.10 可忽略）

* 对于 ImageBuilder 的用户或开发者：

-22.03 的 ImageBuilder 从这里下载 https://fw.koolcenter.com/iStoreOS-22.03/ib/

-24.10 中，rk33xx 和 rk35xx 合并成 rk3xxx

### 系统
* 基于 OpenWRT 24.10.1
* Linux 内核升级到 6.6
* 为防止用户不改默认密码导致中毒，现在没有默认密码，登录网页后台或者 SSH 都会提示设置密码。如果从 22.03 保留配置升级，可能会保留之前的密码，也就是说要么是之前的密码，要么是空。如果密码为空请务必设置密码
* 防火墙切换到 nftables，有些插件可能要自己选择防火墙类型
* nftables 上独家移植 “高性能 FullconeNAT”（BRCM-FullconeNAT），之前版本的另一个 “兼容模式” FullconeNAT 由于性能差未移植（虽然叫“兼容模式”，不过应该兼容性一样）
* 内核开启 BPF，以支持某些特殊应用 [希望24.10构建时加入以下配置以兼容软件包 #2054](https://github.com/istoreos/istoreos/discussions/2054)

### 应用
* Docker：防火墙区域由原来的网络接口 docker0 改成 IP 地址范围 172.16.0.0/12，以解决 FW4 下大部分 docker compose 或其他使用自定义 docker 网络无法访问宿主的问题。如果自定义网络的 IP 地址不在此范围，且需要访问宿主，请自行到防火墙的 Docker 区域添加相应地址范围。
* 统一文件共享：系统关机时不清理 Samba 配置和用户组，并在开机时仅清理配置和无效的用户组而不是全部重建，以免系统重启后权限异常 [统一文件共享 的SMB服务，系统重启导致客户端凭证失效 #2307](https://github.com/istoreos/istoreos/issues/2307)
* 提醒下，如果 统一文件共享 配置了 Samba 共享，系统的 Samba 会生成相应的配置项（也就是“网络共享”页面），别修改这些生成的配置项，改了也会被 统一文件共享 覆盖（手动添加的共享文件夹则不会被覆盖，但建议别在“网络共享”添加共享文件夹，而是都在 “统一文件共享” 里配置）。

### 设备
* RK35xx系列：

-使用主线 6.6 内核，现在支持在线安装内核模块

-6.6 内核上独家支持 VPU （视频编解码器）和 GPU（ARM驱动），其中 RK3588 还支持 NPU

* x86：

-内核启用 PCI mmconfig，以支持某些设备的 SR-IOV 功能

-移植 i915-sriov-dkms 驱动，支持 Intel 12 代以上核显（N100以上）的SR-IOV 功能，并在检测到这些核显时自动加载这个驱动，理论上 PF 和 VF 都能支持（如果虚拟机中核显的 PCI 地址不是 “00:02.0” 则不会自动加载驱动，需要到虚拟机内的 iStoreOS 的 杂项设置-驱动中勾选“i915-sriov”）。支持 SR-IOV 的 Intel 核显可以从这找到 ```https://www.intel.cn/content/www/cn/zh/support/articles/000093216/graphics/processor-graphics.html```

* 增加 树莓派5 固件，未测试
* 增加 armsr 固件，可以部署到 ARM 虚拟机里，例如苹果M系列芯片电脑的虚拟机
* hinlink h88k v3：网口序号跟外壳匹配，外壳的ETH0将是默认WAN口，更新后需要将外壳上ETH0和ETH2的网线交换下
暂未支持 RK3528，RK3576，RK3582 系列机型（如 Hilink h28k，Radxa e20c/e52c 等），需要后续开发

### 更新后
* 从22.03升级后，已知问题和解决方法：

-haproxy 无法启动，可以从软件包更新，更新完就正常了

-Transmission 无法启动，从 iStore 卸载重装即可。安装时选择“仅安装”，以免修改之前的配置。安装以后可能要重启下 Transmission 让webui 重新加载

-airplay2 无法运行，从 iStore 卸载重装，如果还有问题，软件包里更新下 “libsodium”

-socat 端口转发已经不再是必须的，现在的防火墙已经支持ipv4和ipv6之间互相转发，socat插件完全失去了原来的独特优势

* 其他无法运行的程序可以在系统日志搜索 “crash loop” ，前面有程序名称，一般卸载重装即可。

* 从软件包更新部分软件的步骤：

-打开后台，系统-软件包

-如果下边“可用”列表是空的，点一下上面的“更新列表...”，等待完成

-过滤器”输入想更新的软件包，下边的列表就会剩下相关的软件包了，找到右边有升级按钮的，升级即可

注意不要随便升级其他不了解或者系统的软件包，只升级自己曾经安装且无法运行的软件包。

